<div class="metrics-container">
  <!-- Header com tÃ­tulo do relationship -->
  <div class="table-title">
    <h3>{{ relationshipName() }}</h3>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <button
      pButton
      type="button"
      label="Settings"
      icon="pi pi-cog"
      class="toolbar-btn p-button-text p-button-plain"
      disabled
    ></button>
    <button
      pButton
      type="button"
      label="Accumulate Rows"
      icon="pi pi-arrow-up"
      class="toolbar-btn p-button-text p-button-plain"
      [class.active]="isAccumulated()"
      (click)="toggleAccumulate()"
    ></button>
    <button
      pButton
      type="button"
      [label]="showExpandedView() ? 'Collapse Table' : 'Expand Table'"
      icon="pi pi-expand"
      class="toolbar-btn p-button-text p-button-plain"
      (click)="toggleExpandedView()"
    ></button>
    <button
      pButton
      type="button"
      label="Copy Selected Rows"
      icon="pi pi-copy"
      class="toolbar-btn p-button-text p-button-plain"
      (click)="copySelectedRows()"
      [disabled]="selectedRows().size === 0"
    ></button>
    <button
      pButton
      type="button"
      label="Copy Table"
      icon="pi pi-table"
      class="toolbar-btn p-button-text p-button-plain"
      (click)="copyTable()"
    ></button>
  </div>

  <!-- Table Wrapper -->
  <div 
    class="table-wrapper"
    [class.expanded]="showExpandedView()"
  >
    <table class="metrics-table">
      <thead>
        <tr>
          <th class="checkbox-col">
            <i class="pi pi-filter filter-icon"></i>
          </th>
          <th class="series-name-col">
            <div class="header-content">
              <span>Series Name</span>
              <i class="pi pi-filter filter-icon"></i>
            </div>
          </th>
          @for (date of tableData().dateColumns; track date) {
            <th class="date-col">
              <div class="header-content">
                <span>{{ date }}</span>
                <i class="pi pi-filter filter-icon"></i>
              </div>
            </th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of tableData().rows; track row.seriesName) {
          <tr [class.selected]="isRowSelected(row.seriesName)">
            <td class="checkbox-col">
              <p-checkbox
                [binary]="true"
                [ngModel]="isRowSelected(row.seriesName)"
                (onChange)="toggleRowSelection(row.seriesName)"
              />
            </td>
            <td class="series-name-cell">
              {{ row.seriesName }}
            </td>
            @for (date of tableData().dateColumns; track date) {
              <td class="value-cell">
                {{ row.values[date] || '-' }}
              </td>
            }
          </tr>
        } @empty {
          <tr>
            <td [colSpan]="tableData().dateColumns.length + 2" class="empty-cell">
              No metrics data available
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
