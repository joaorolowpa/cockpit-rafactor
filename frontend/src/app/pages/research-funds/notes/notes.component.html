<div appPageContainer>
  <div appPageHeader>
    <div>
      <h1 class="page-title">Funds Notes Files Types</h1>
      <p class="page-subtitle">Manage notes and document types for funds</p>
    </div>
    <div appPageActions>
      <button class="btn btn-primary" type="button" (click)="openDialog()">
        Add new Type
      </button>
    </div>
  </div>

  <div appTableContainer>
    <div appFiltersBar>
      <app-search-input
        placeholder="Search for a note type"
        [value]="searchTerm()"
        [disabled]="loading()"
        (valueChange)="searchTerm.set($event); onSearch()"
        (cleared)="clearSearch()"
      ></app-search-input>
    </div>

    <app-state
      *ngIf="loading()"
      type="loading"
      icon="pi pi-spinner pi-spin"
      message="Loading note types..."
    ></app-state>

    <app-state
      *ngIf="error() && !loading()"
      type="error"
      icon="pi pi-exclamation-circle"
      [message]="error() || ''"
      actionLabel="Retry"
      (action)="loadTypes()"
    ></app-state>

    <div *ngIf="!loading() && !error()" appTableWrapper>
      <table appDataTable class="notes-types-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Description</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredTypes(); trackBy: trackById">
            <td>{{ item.id }}</td>
            <td class="name-cell">{{ item.display_name }}</td>
            <td class="description-cell">{{ item.description || '-' }}</td>
            <td>{{ formatCreatedAt(item.created_at) }}</td>
            <td class="actions-cell">
              <button
                type="button"
                class="btn btn-icon btn-text action-icon-btn delete-btn"
                (click)="requestDeleteType(item)"
                [disabled]="!isDeletable(item)"
                [title]="isDeletable(item) ? 'Delete type' : 'Delete disabled (older than 7 days)'"
              >
                <i class="pi pi-trash"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="filteredTypes().length === 0">
            <td colspan="5">
              <app-state type="empty" icon="pi pi-info-circle" message="No note types found" size="compact"></app-state>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="!loading() && !error()" class="table-footer">
    <span class="results-count">
      Showing {{ filteredTypes().length }} of {{ types().length }} types
    </span>
  </div>
</div>

<app-funds-note-type-dialog
  *ngIf="showDialog()"
  (close)="closeDialog()"
  (created)="onTypeCreated($event)"
></app-funds-note-type-dialog>

<app-confirm-dialog
  *ngIf="confirmTarget()"
  title="Delete note type"
  [message]="'Delete \"' + (confirmTarget()?.display_name || 'note type') + '\"?'"
  confirmLabel="Delete"
  confirmVariant="danger"
  (confirm)="confirmDeleteType()"
  (cancel)="cancelDeleteType()"
></app-confirm-dialog>
